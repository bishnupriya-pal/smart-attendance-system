from flask import Flask, render_template, request, redirect, sessionimport sqlite3import datetimeapp = Flask(__name__)app.secret_key = "supersecretkey"# Database connectiondef get_db():    conn = sqlite3.connect("attendance.db")    conn.row_factory = sqlite3.Row    return conn# Create tables if not existconn = get_db()conn.execute("""CREATE TABLE IF NOT EXISTS students (    id INTEGER PRIMARY KEY AUTOINCREMENT,    name TEXT UNIQUE)""")conn.execute("""CREATE TABLE IF NOT EXISTS attendance (    id INTEGER PRIMARY KEY AUTOINCREMENT,    student_id INTEGER,    date TEXT,    status TEXT,    FOREIGN KEY(student_id) REFERENCES students(id))""")conn.commit()conn.close()@app.route("/login", methods=["GET", "POST"])def login():    if request.method == "POST":        username = request.form["username"]        password = request.form["password"]        if username == "admin" and password == "admin123":            session["user"] = username            return redirect("/")        else:            return "Invalid Credentials"    return render_template("login.html")@app.route("/")def index():    if "user" not in session:        return redirect("/login")    conn = get_db()    students = conn.execute("SELECT * FROM students").fetchall()    conn.close()    return render_template("index.html", students=students)@app.route("/add", methods=["GET", "POST"])def add_student():    if "user" not in session:        return redirect("/login")    if request.method == "POST":        name = request.form["name"]        conn = get_db()        try:            conn.execute("INSERT INTO students (name) VALUES (?)", (name,))            conn.commit()        except:            pass        conn.close()        return redirect("/")    return render_template("add_student.html")@app.route("/mark", methods=["GET", "POST"])def mark_attendance():    if "user" not in session:        return redirect("/login")    conn = get_db()    students = conn.execute("SELECT * FROM students").fetchall()    if request.method == "POST":        date = str(datetime.date.today())        for student in students:            status = request.form.get(str(student["id"]))            if status:                conn.execute(                    "INSERT INTO attendance (student_id, date, status) VALUES (?, ?, ?)",                    (student["id"], date, status),                )        conn.commit()        conn.close()        return redirect("/")    conn.close()    return render_template("mark_attendance.html", students=students)@app.route("/report")def report():    if "user" not in session:        return redirect("/login")    conn = get_db()    query = """    SELECT s.name,           COUNT(a.student_id) as total,           SUM(CASE WHEN a.status='P' THEN 1 ELSE 0 END) as present    FROM students s    LEFT JOIN attendance a ON s.id = a.student_id    GROUP BY s.id    """    results = conn.execute(query).fetchall()    conn.close()    report_data = []    for row in results:        total = row["total"] if row["total"] else 0        present = row["present"] if row["present"] else 0        percentage = (present / total * 100) if total > 0 else 0        report_data.append({            "name": row["name"],            "total": total,            "present": present,            "percentage": round(percentage, 2)        })    return render_template("report.html", report_data=report_data)@app.route("/logout")def logout():    session.pop("user", None)    return redirect("/login")if __name__ == "__main__":    app.run(debug=True)